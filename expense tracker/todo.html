<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>To-Do List</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <a href="index.html">&larr; Back to Dashboard</a>
  <div class="card" style="max-width: 600px; margin: 40px auto;">
    <h2>To-Do List</h2>
    
    <!-- Add new todo form -->
    <form id="addTodoForm" style="margin-bottom: 20px;">
      <input type="text" id="todoTask" placeholder="Enter task details" required style="width: 70%;">
      <button type="submit">Add Task</button>
    </form>
    
    <!-- Todo list -->
    <ul id="todoList" class="todo-list">
      <!-- Todos will be loaded here -->
    </ul>
    
    <!-- Statistics -->
    <div style="margin-top: 20px; padding: 15px; background: #f7fafc; border-radius: 10px;">
      <h4>Statistics</h4>
      <p>Total Tasks: <span id="totalTasks">0</span></p>
      <p>Completed: <span id="completedTasks">0</span></p>
      <p>Pending: <span id="pendingTasks">0</span></p>
    </div>
    
    <p>Manage your tasks here.</p>
  </div>

  <script>
    // Load todos on page load
    loadTodos();

    // Add todo form handler
    document.getElementById('addTodoForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const task = document.getElementById('todoTask').value;
      
      try {
        const response = await fetch('/api/todos', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ task })
        });
        
        if (response.ok) {
          document.getElementById('todoTask').value = '';
          loadTodos();
        }
      } catch (error) {
        console.error('Error adding todo:', error);
      }
    });

    async function loadTodos() {
      try {
        const response = await fetch('/api/todos');
        const data = await response.json();
        const todoList = document.getElementById('todoList');
        
        todoList.innerHTML = data.todos.map(todo => `
          <li style="display: flex; align-items: center; padding: 10px 0; border-bottom: 1px solid #f7fafc;">
            <input type="checkbox" ${todo.completed ? 'checked' : ''} 
                   onchange="toggleTodo(${todo.id}, this.checked)" style="margin-right: 10px;">
            <span style="${todo.completed ? 'text-decoration: line-through; color: #718096;' : ''} flex-grow: 1;">
              ${todo.task}
            </span>
            <small style="color: #718096; margin-right: 10px;">
              ${new Date(todo.created).toLocaleDateString()}
            </small>
            <button onclick="deleteTodo(${todo.id})" style="background: #e53e3e; padding: 5px 10px; font-size: 0.8rem;">Delete</button>
          </li>
        `).join('');
        
        // Update statistics
        updateStatistics(data.todos);
      } catch (error) {
        console.error('Error loading todos:', error);
      }
    }

    function updateStatistics(todos) {
      const total = todos.length;
      const completed = todos.filter(todo => todo.completed).length;
      const pending = total - completed;
      
      document.getElementById('totalTasks').textContent = total;
      document.getElementById('completedTasks').textContent = completed;
      document.getElementById('pendingTasks').textContent = pending;
    }

    async function toggleTodo(id, completed) {
      try {
        await fetch(`/api/todos/${id}`, {
          method: 'PUT',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ completed })
        });
        loadTodos();
      } catch (error) {
        console.error('Error updating todo:', error);
      }
    }

    async function deleteTodo(id) {
      if (confirm('Are you sure you want to delete this task?')) {
        try {
          await fetch(`/api/todos/${id}`, { method: 'DELETE' });
          loadTodos();
        } catch (error) {
          console.error('Error deleting todo:', error);
        }
      }
    }
  </script>
</body>
</html> 