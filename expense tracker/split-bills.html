<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Split Bills</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <a href="index.html">&larr; Back to Dashboard</a>
  <div class="card" style="max-width: 700px; margin: 40px auto;">
    <h2>Split Bills with Friends</h2>
    
    <!-- Add new bill form -->
    <form id="addBillForm" style="margin-bottom: 20px; padding: 20px; background: #f7fafc; border-radius: 10px;">
      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
        <div>
          <label>Description:</label>
          <input type="text" id="billDescription" placeholder="e.g., Dinner at restaurant" required style="width: 100%;">
        </div>
        <div>
          <label>Total Amount (₹):</label>
          <input type="number" id="billAmount" placeholder="120.00" step="0.01" required style="width: 100%;">
        </div>
        <div>
          <label>Split Between:</label>
          <input type="number" id="billSplit" placeholder="4" min="1" required style="width: 100%;">
        </div>
        <div>
          <label>Date:</label>
          <input type="date" id="billDate" style="width: 100%;">
        </div>
      </div>
      <div>
        <label>Friends (comma separated):</label>
        <input type="text" id="billFriends" placeholder="John, Sarah, Mike, You" style="width: 100%;">
      </div>
      <button type="submit" style="margin-top: 15px;">Calculate Split</button>
    </form>
    
    <!-- Bills list -->
    <div id="billsList">
      <!-- Bills will be loaded here -->
    </div>
    
    <p>Calculate and split bills with your friends here.</p>
  </div>

  <script>
    // Set default date to today
    document.getElementById('billDate').value = new Date().toISOString().split('T')[0];
    
    // Load bills on page load
    loadBills();

    // Add bill form handler
    document.getElementById('addBillForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const description = document.getElementById('billDescription').value;
      const totalAmount = parseFloat(document.getElementById('billAmount').value);
      const splitBetween = parseInt(document.getElementById('billSplit').value);
      const date = document.getElementById('billDate').value;
      const friends = document.getElementById('billFriends').value.split(',').map(f => f.trim()).filter(f => f);
      
      try {
        const response = await fetch('/api/bills', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ description, totalAmount, splitBetween, date, friends })
        });
        
        if (response.ok) {
          document.getElementById('billDescription').value = '';
          document.getElementById('billAmount').value = '';
          document.getElementById('billSplit').value = '';
          document.getElementById('billFriends').value = '';
          loadBills();
        }
      } catch (error) {
        console.error('Error adding bill:', error);
      }
    });

    async function loadBills() {
      try {
        const response = await fetch('/api/bills');
        const data = await response.json();
        const billsList = document.getElementById('billsList');
        
        billsList.innerHTML = `
          <h3>Recent Bills</h3>
          ${data.bills.map(bill => `
            <div style="border: 1px solid #e2e8f0; border-radius: 10px; padding: 20px; margin-bottom: 15px; background: white;">
              <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                <div>
                  <h4 style="margin: 0; color: #2d3748; font-size: 1.2rem;">${bill.description}</h4>
                  <small style="color: #718096;">${bill.date}</small>
                </div>
                <button onclick="deleteBill(${bill.id})" style="background: #e53e3e; padding: 6px 14px; font-size: 0.9rem; border-radius: 6px; color: white; border: none;">Delete</button>
              </div>
              <table style="width: 100%; border-collapse: collapse; margin-bottom: 12px;">
                <tr>
                  <td style="padding: 8px 0; font-weight: 600; color: #4a5568;">Total Amount</td>
                  <td style="padding: 8px 0;">₹${bill.totalAmount}</td>
                  <td style="padding: 8px 0; font-weight: 600; color: #4a5568;">Split Between</td>
                  <td style="padding: 8px 0;">${bill.splitBetween} people</td>
                  <td style="padding: 8px 0; font-weight: 600; color: #4a5568;">Per Person</td>
                  <td style="padding: 8px 0;">₹${bill.amountPerPerson.toFixed(2)}</td>
                </tr>
              </table>
              <div style="margin-bottom: 5px;"><strong>Friends:</strong> <span style="color: #718096;">${bill.friends.join(', ')}</span></div>
            </div>
          `).join('')}
        `;
      } catch (error) {
        console.error('Error loading bills:', error);
      }
    }

    async function deleteBill(id) {
      if (confirm('Are you sure you want to delete this bill?')) {
        try {
          await fetch(`/api/bills/${id}`, { method: 'DELETE' });
          loadBills();
        } catch (error) {
          console.error('Error deleting bill:', error);
        }
      }
    }
  </script>
</body>
</html> 